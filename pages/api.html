<div class="container">
    <a href="#" class="back-button">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É —Ç–µ–º</a>
    
    <div class="page-header">
        <h1>üåê –†–∞–±–æ—Ç–∞ —Å API</h1>
        <p>Fetch API, XMLHttpRequest, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤, –æ—à–∏–±–æ–∫ –∏ —Ä–∞–±–æ—Ç–∞ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö</p>
    </div>

    <div class="content-section">
        <h2>Fetch API</h2>
        <p>–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —Ä–∞–±–æ—Ç—ã —Å HTTP –∑–∞–ø—Ä–æ—Å–∞–º–∏. –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ Promises.</p>
        
        <div class="code-block">
            <span class="code-block-title">–ü—Ä–∏–º–µ—Ä 1: –ë–∞–∑–æ–≤—ã–π GET –∑–∞–ø—Ä–æ—Å</span>
            <pre><code><span class="comment">// –ü—Ä–æ—Å—Ç–æ–π GET –∑–∞–ø—Ä–æ—Å</span>
<span class="function">fetch</span>(<span class="string">"https://api.example.com/users"</span>)
    .<span class="function">then</span>(<span class="variable">response</span> =&gt; <span class="variable">response</span>.<span class="function">json</span>())
    .<span class="function">then</span>(<span class="variable">data</span> =&gt; {
        <span class="function">console</span>.<span class="function">log</span>(<span class="variable">data</span>);
    })
    .<span class="function">catch</span>(<span class="variable">error</span> =&gt; {
        <span class="function">console</span>.<span class="function">error</span>(<span class="string">"–û—à–∏–±–∫–∞:"</span>, <span class="variable">error</span>);
    });

<span class="comment">// –° async/await</span>
<span class="keyword">async</span> <span class="function">function</span> <span class="function">getUsers</span>() {
    <span class="keyword">try</span> {
        <span class="keyword">const</span> <span class="variable">response</span> = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">"https://api.example.com/users"</span>);
        <span class="keyword">const</span> <span class="variable">data</span> = <span class="keyword">await</span> <span class="variable">response</span>.<span class="function">json</span>();
        <span class="function">console</span>.<span class="function">log</span>(<span class="variable">data</span>);
    } <span class="keyword">catch</span> (<span class="variable">error</span>) {
        <span class="function">console</span>.<span class="function">error</span>(<span class="string">"–û—à–∏–±–∫–∞:"</span>, <span class="variable">error</span>);
    }
}</code></pre>
        </div>

        <div class="code-block">
            <span class="code-block-title">–ü—Ä–∏–º–µ—Ä 2: POST –∑–∞–ø—Ä–æ—Å</span>
            <pre><code><span class="comment">// POST —Å JSON</span>
<span class="keyword">async</span> <span class="function">function</span> <span class="function">createUser</span>(<span class="variable">userData</span>) {
    <span class="keyword">try</span> {
        <span class="keyword">const</span> <span class="variable">response</span> = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">"https://api.example.com/users"</span>, {
            <span class="variable">method</span>: <span class="string">"POST"</span>,
            <span class="variable">headers</span>: {
                <span class="string">"Content-Type"</span>: <span class="string">"application/json"</span>
            },
            <span class="variable">body</span>: <span class="function">JSON</span>.<span class="function">stringify</span>(<span class="variable">userData</span>)
        });
        
        <span class="keyword">if</span> (!<span class="variable">response</span>.<span class="variable">ok</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="function">Error</span>(<span class="string">`HTTP ${response.status}`</span>);
        }
        
        <span class="keyword">const</span> <span class="variable">data</span> = <span class="keyword">await</span> <span class="variable">response</span>.<span class="function">json</span>();
        <span class="keyword">return</span> <span class="variable">data</span>;
    } <span class="keyword">catch</span> (<span class="variable">error</span>) {
        <span class="function">console</span>.<span class="function">error</span>(<span class="string">"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:"</span>, <span class="variable">error</span>);
        <span class="keyword">throw</span> <span class="variable">error</span>;
    }
}

<span class="keyword">const</span> <span class="variable">newUser</span> = {
    <span class="variable">name</span>: <span class="string">"–ò–≤–∞–Ω"</span>,
    <span class="variable">email</span>: <span class="string">"ivan@example.com"</span>
};

<span class="function">createUser</span>(<span class="variable">newUser</span>);</code></pre>
        </div>

        <div class="code-block">
            <span class="code-block-title">–ü—Ä–∏–º–µ—Ä 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫</span>
            <pre><code><span class="comment">// –í–∞–∂–Ω–æ: fetch –Ω–µ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç Promise –ø—Ä–∏ HTTP –æ—à–∏–±–∫–∞—Ö!</span>
<span class="function">fetch</span>(<span class="string">"https://api.example.com/users"</span>)
    .<span class="function">then</span>(<span class="variable">response</span> =&gt; {
        <span class="keyword">if</span> (!<span class="variable">response</span>.<span class="variable">ok</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="function">Error</span>(<span class="string">`HTTP ${response.status}: ${response.statusText}`</span>);
        }
        <span class="keyword">return</span> <span class="variable">response</span>.<span class="function">json</span>();
    })
    .<span class="function">then</span>(<span class="variable">data</span> =&gt; {
        <span class="function">console</span>.<span class="function">log</span>(<span class="variable">data</span>);
    })
    .<span class="function">catch</span>(<span class="variable">error</span> =&gt; {
        <span class="keyword">if</span> (<span class="variable">error</span>.<span class="variable">name</span> === <span class="string">"TypeError"</span>) {
            <span class="function">console</span>.<span class="function">error</span>(<span class="string">"–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –∏–ª–∏ CORS"</span>);
        } <span class="keyword">else</span> {
            <span class="function">console</span>.<span class="function">error</span>(<span class="string">"–û—à–∏–±–∫–∞:"</span>, <span class="variable">error</span>.<span class="variable">message</span>);
        }
    });

<span class="comment">// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è</span>
<span class="keyword">async</span> <span class="function">function</span> <span class="function">fetchJSON</span>(<span class="variable">url</span>, <span class="variable">options</span> = {}) {
    <span class="keyword">const</span> <span class="variable">response</span> = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="variable">url</span>, <span class="variable">options</span>);
    
    <span class="keyword">if</span> (!<span class="variable">response</span>.<span class="variable">ok</span>) {
        <span class="keyword">const</span> <span class="variable">error</span> = <span class="keyword">new</span> <span class="function">Error</span>(<span class="string">`HTTP ${response.status}`</span>);
        <span class="variable">error</span>.<span class="variable">status</span> = <span class="variable">response</span>.<span class="variable">status</span>;
        <span class="variable">error</span>.<span class="variable">response</span> = <span class="variable">response</span>;
        <span class="keyword">throw</span> <span class="variable">error</span>;
    }
    
    <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable">response</span>.<span class="function">json</span>();
}</code></pre>
        </div>

        <div class="code-block">
            <span class="code-block-title">–ü—Ä–∏–º–µ—Ä 4: –†–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –æ—Ç–≤–µ—Ç–æ–≤</span>
            <pre><code><span class="keyword">async</span> <span class="function">function</span> <span class="function">handleResponse</span>(<span class="variable">url</span>) {
    <span class="keyword">const</span> <span class="variable">response</span> = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="variable">url</span>);
    
    <span class="comment">// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</span>
    <span class="keyword">const</span> <span class="variable">contentType</span> = <span class="variable">response</span>.<span class="variable">headers</span>.<span class="function">get</span>(<span class="string">"content-type"</span>);
    
    <span class="keyword">if</span> (<span class="variable">contentType</span>?.<span class="function">includes</span>(<span class="string">"application/json"</span>)) {
        <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable">response</span>.<span class="function">json</span>();
    } <span class="keyword">else if</span> (<span class="variable">contentType</span>?.<span class="function">includes</span>(<span class="string">"text"</span>)) {
        <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable">response</span>.<span class="function">text</span>();
    } <span class="keyword">else if</span> (<span class="variable">contentType</span>?.<span class="function">includes</span>(<span class="string">"blob"</span>)) {
        <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable">response</span>.<span class="function">blob</span>();
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable">response</span>.<span class="function">arrayBuffer</span>();
    }
}

<span class="comment">// –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞</span>
<span class="keyword">async</span> <span class="function">function</span> <span class="function">downloadFile</span>(<span class="variable">url</span>, <span class="variable">filename</span>) {
    <span class="keyword">const</span> <span class="variable">response</span> = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="variable">url</span>);
    <span class="keyword">const</span> <span class="variable">blob</span> = <span class="keyword">await</span> <span class="variable">response</span>.<span class="function">blob</span>();
    <span class="keyword">const</span> <span class="variable">objectUrl</span> = <span class="function">URL</span>.<span class="function">createObjectURL</span>(<span class="variable">blob</span>);
    
    <span class="keyword">const</span> <span class="variable">a</span> = <span class="function">document</span>.<span class="function">createElement</span>(<span class="string">"a"</span>);
    <span class="variable">a</span>.<span class="variable">href</span> = <span class="variable">objectUrl</span>;
    <span class="variable">a</span>.<span class="variable">download</span> = <span class="variable">filename</span>;
    <span class="variable">a</span>.<span class="function">click</span>();
    
    <span class="function">URL</span>.<span class="function">revokeObjectURL</span>(<span class="variable">objectUrl</span>);
}</code></pre>
        </div>

        <div class="code-block">
            <span class="code-block-title">–ü—Ä–∏–º–µ—Ä 5: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ (FormData)</span>
            <pre><code><span class="keyword">async</span> <span class="function">function</span> <span class="function">uploadFile</span>(<span class="variable">file</span>) {
    <span class="keyword">const</span> <span class="variable">formData</span> = <span class="keyword">new</span> <span class="function">FormData</span>();
    <span class="variable">formData</span>.<span class="function">append</span>(<span class="string">"file"</span>, <span class="variable">file</span>);
    <span class="variable">formData</span>.<span class="function">append</span>(<span class="string">"description"</span>, <span class="string">"–ú–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"</span>);
    
    <span class="keyword">const</span> <span class="variable">response</span> = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">"https://api.example.com/upload"</span>, {
        <span class="variable">method</span>: <span class="string">"POST"</span>,
        <span class="comment">// –ù–µ —É–∫–∞–∑—ã–≤–∞–µ–º Content-Type! –ë—Ä–∞—É–∑–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–∏—Ç —Å boundary</span>
        <span class="variable">body</span>: <span class="variable">formData</span>
    });
    
    <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable">response</span>.<span class="function">json</span>();
}</code></pre>
        </div>

        <div class="code-block">
            <span class="code-block-title">–ü—Ä–∏–º–µ—Ä 6: –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –æ–ø—Ü–∏–∏</span>
            <pre><code><span class="keyword">async</span> <span class="function">function</span> <span class="function">apiCall</span>(<span class="variable">url</span>, <span class="variable">token</span>) {
    <span class="keyword">const</span> <span class="variable">response</span> = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="variable">url</span>, {
        <span class="variable">method</span>: <span class="string">"GET"</span>,
        <span class="variable">headers</span>: {
            <span class="string">"Authorization"</span>: <span class="string">`Bearer ${token}`</span>,
            <span class="string">"Content-Type"</span>: <span class="string">"application/json"</span>,
            <span class="string">"X-Custom-Header"</span>: <span class="string">"value"</span>
        },
        <span class="variable">credentials</span>: <span class="string">"include"</span>,  <span class="comment">// –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å cookies</span>
        <span class="comment">// credentials: "same-origin" - —Ç–æ–ª—å–∫–æ –¥–ª—è same-origin</span>
        <span class="comment">// credentials: "omit" - –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å</span>
        <span class="variable">mode</span>: <span class="string">"cors"</span>,  <span class="comment">// cors, no-cors, same-origin</span>
        <span class="variable">cache</span>: <span class="string">"no-cache"</span>,  <span class="comment">// no-cache, reload, force-cache</span>
        <span class="variable">redirect</span>: <span class="string">"follow"</span>  <span class="comment">// follow, error, manual</span>
    });
    
    <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable">response</span>.<span class="function">json</span>();
}</code></pre>
        </div>

        <div class="code-block">
            <span class="code-block-title">–ü—Ä–∏–º–µ—Ä 7: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã</span>
            <pre><code><span class="comment">// –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã</span>
<span class="keyword">async</span> <span class="function">function</span> <span class="function">loadUserData</span>(<span class="variable">userId</span>) {
    <span class="keyword">const</span> [<span class="variable">user</span>, <span class="variable">posts</span>, <span class="variable">comments</span>] = <span class="keyword">await</span> <span class="function">Promise</span>.<span class="function">all</span>([
        <span class="function">fetch</span>(<span class="string">`/api/users/${userId}`</span>).<span class="function">then</span>(<span class="variable">r</span> =&gt; <span class="variable">r</span>.<span class="function">json</span>()),
        <span class="function">fetch</span>(<span class="string">`/api/users/${userId}/posts`</span>).<span class="function">then</span>(<span class="variable">r</span> =&gt; <span class="variable">r</span>.<span class="function">json</span>()),
        <span class="function">fetch</span>(<span class="string">`/api/users/${userId}/comments`</span>).<span class="function">then</span>(<span class="variable">r</span> =&gt; <span class="variable">r</span>.<span class="function">json</span>())
    ]);
    
    <span class="keyword">return</span> { <span class="variable">user</span>, <span class="variable">posts</span>, <span class="variable">comments</span> };
}

<span class="comment">// –° –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫</span>
<span class="keyword">async</span> <span class="function">function</span> <span class="function">loadUserDataSafe</span>(<span class="variable">userId</span>) {
    <span class="keyword">const</span> <span class="variable">results</span> = <span class="keyword">await</span> <span class="function">Promise</span>.<span class="function">allSettled</span>([
        <span class="function">fetch</span>(<span class="string">`/api/users/${userId}`</span>).<span class="function">then</span>(<span class="variable">r</span> =&gt; <span class="variable">r</span>.<span class="function">json</span>()),
        <span class="function">fetch</span>(<span class="string">`/api/users/${userId}/posts`</span>).<span class="function">then</span>(<span class="variable">r</span> =&gt; <span class="variable">r</span>.<span class="function">json</span>()),
        <span class="function">fetch</span>(<span class="string">`/api/users/${userId}/comments`</span>).<span class="function">then</span>(<span class="variable">r</span> =&gt; <span class="variable">r</span>.<span class="function">json</span>())
    ]);
    
    <span class="keyword">return</span> {
        <span class="variable">user</span>: <span class="variable">results</span>[<span class="number">0</span>].<span class="variable">status</span> === <span class="string">"fulfilled"</span> ? <span class="variable">results</span>[<span class="number">0</span>].<span class="variable">value</span> : <span class="keyword">null</span>,
        <span class="variable">posts</span>: <span class="variable">results</span>[<span class="number">1</span>].<span class="variable">status</span> === <span class="string">"fulfilled"</span> ? <span class="variable">results</span>[<span class="number">1</span>].<span class="variable">value</span> : [],
        <span class="variable">comments</span>: <span class="variable">results</span>[<span class="number">2</span>].<span class="variable">status</span> === <span class="string">"fulfilled"</span> ? <span class="variable">results</span>[<span class="number">2</span>].<span class="variable">value</span> : []
    };
}</code></pre>
        </div>

        <div class="code-block">
            <span class="code-block-title">–ü—Ä–∏–º–µ—Ä 8: AbortController - –æ—Ç–º–µ–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞</span>
            <pre><code><span class="comment">// –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞</span>
<span class="keyword">const</span> <span class="variable">controller</span> = <span class="keyword">new</span> <span class="function">AbortController</span>();
<span class="keyword">const</span> <span class="variable">signal</span> = <span class="variable">controller</span>.<span class="variable">signal</span>;

<span class="comment">// –ó–∞–ø—Ä–æ—Å —Å —Å–∏–≥–Ω–∞–ª–æ–º</span>
<span class="function">fetch</span>(<span class="string">"https://api.example.com/data"</span>, {
    <span class="variable">signal</span>: <span class="variable">signal</span>
})
    .<span class="function">then</span>(<span class="variable">response</span> =&gt; <span class="variable">response</span>.<span class="function">json</span>())
    .<span class="function">then</span>(<span class="variable">data</span> =&gt; <span class="function">console</span>.<span class="function">log</span>(<span class="variable">data</span>))
    .<span class="function">catch</span>(<span class="variable">error</span> =&gt; {
        <span class="keyword">if</span> (<span class="variable">error</span>.<span class="variable">name</span> === <span class="string">"AbortError"</span>) {
            <span class="function">console</span>.<span class="function">log</span>(<span class="string">"–ó–∞–ø—Ä–æ—Å –æ—Ç–º–µ–Ω–µ–Ω"</span>);
        }
    });

<span class="comment">// –û—Ç–º–µ–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞</span>
<span class="variable">controller</span>.<span class="function">abort</span>();

<span class="comment">// –ü—Ä–∏–º–µ—Ä —Å —Ç–∞–π–º–∞—É—Ç–æ–º</span>
<span class="function">function</span> <span class="function">fetchWithTimeout</span>(<span class="variable">url</span>, <span class="variable">timeout</span> = <span class="number">5000</span>) {
    <span class="keyword">const</span> <span class="variable">controller</span> = <span class="keyword">new</span> <span class="function">AbortController</span>();
    <span class="keyword">const</span> <span class="variable">timeoutId</span> = <span class="function">setTimeout</span>(() =&gt; <span class="variable">controller</span>.<span class="function">abort</span>(), <span class="variable">timeout</span>);
    
    <span class="keyword">return</span> <span class="function">fetch</span>(<span class="variable">url</span>, { <span class="variable">signal</span>: <span class="variable">controller</span>.<span class="variable">signal</span> })
        .<span class="function">then</span>(<span class="variable">response</span> =&gt; {
            <span class="function">clearTimeout</span>(<span class="variable">timeoutId</span>);
            <span class="keyword">return</span> <span class="variable">response</span>;
        })
        .<span class="function">catch</span>(<span class="variable">error</span> =&gt; {
            <span class="function">clearTimeout</span>(<span class="variable">timeoutId</span>);
            <span class="keyword">throw</span> <span class="variable">error</span>;
        });
}</code></pre>
        </div>

        <div class="warning">
            <strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> Fetch –Ω–µ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç Promise –ø—Ä–∏ HTTP –æ—à–∏–±–∫–∞—Ö (404, 500 –∏ —Ç.–¥.). –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ response.ok –∏–ª–∏ response.status. –ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ.
        </div>
    </div>
</div>

